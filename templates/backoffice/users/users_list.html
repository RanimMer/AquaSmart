{% extends "backoffice/base.html" %}
{% load static %}

{% block title %}Utilisateurs{% endblock %}
{% block page_title %}Gestion des utilisateurs{% endblock %}

{% block content %}
<style>
  /* Ligne sp√©ciale pour l'admin (propri√©taire) */
  .admin-row {
    background-color: #fff1cdff; /* jaune p√¢le type "alert" */
  }
</style>
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h3 style="margin:0;">Utilisateurs</h3>
    <a href="{% url 'user_create' %}" class="btn btn-success" style="padding:8px 14px;border-radius:8px;">+ Nouvel utilisateur</a>
  </div>

  <table>
    <thead>
      <tr>
        <th>Avatar</th>
        <th>Username</th>
        <th>Email</th>
        <th>Pr√©nom</th>
        <th>Nom</th>
        <th>R√¥le</th>
        <th>Ferme</th>
        <th>Actif</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr class="{% if u.profile.role == 'ADMIN' %}admin-row{% endif %}">
        <td>
          {% if u.profile.avatar %}
            <img src="{{ u.profile.avatar.url }}" alt="avatar" style="width:36px;height:36px;border-radius:50%;">
          {% else %}
            <img src="{% static 'img/undraw_profile.svg' %}" alt="avatar" style="width:36px;height:36px;border-radius:50%;">
          {% endif %}
        </td>
        <td>{{ u.username }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.first_name }}</td>
        <td>{{ u.last_name }}</td>
        <td>
          {% if u.profile.role == 'ADMIN' %}
            <span class="badge bg-warning text-dark">üëë Propri√©taire</span>
          {% else %}
            <span class="badge bg-success">Employ√© agricole</span>
          {% endif %}
        </td>

        <td>{{ u.profile.farm|default:"-" }}</td>
        <td>{{ u.is_active|yesno:"Oui,Non" }}</td>
        <td>
          <a href="{% url 'user_edit' u.id %}" class="btn btn-sm btn-primary">√âditer</a>
          <a href="{% url 'user_delete' u.id %}" class="btn btn-sm btn-danger">Supprimer</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="9">Aucun utilisateur.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
